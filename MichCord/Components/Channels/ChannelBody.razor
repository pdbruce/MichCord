@using MichCord.Data
@using MichCord.Components.Messages
@inject AppMeta meta
<div class="channel-container">
    <div class="channel-header">
        <h2>@meta.CurrentChannel.Name</h2>
        <p>@meta.CurrentChannel.Description</p>
    </div>

    <div class="message-stream">
        @foreach(var message in messages)
        {
            <MessageBody 
                messageContent="@message.content"
                user="@message.sender"
                timeSent="@message.timeSent.ToString()"
                />
        }
    </div>
    <form>
        <textarea type="text" @bind="message" @bind:event="oninput"></textarea>
        <input type="button" value="Send" @onclick="sendMessage"/>
    </form>
</div>
@code {
    //TODO:
    // sketch some logic for loading messages from db

    protected override void OnInitialized()
    {
        meta.Notify += () => InvokeAsync(StateHasChanged);
                messages.Add(
            new Message(
                "hello and welcome to the channel",
                new User("hi", "hey", "hello")
            )
        );
    }

    private List<Message> messages = new List<Message>();
    User testUser = new User("Test", "User", "testuser");
    private string? message { get; set; }
    public void sendMessage()
    {
        messages.Add(new Message(message, testUser));
        message = "";
    }
}
